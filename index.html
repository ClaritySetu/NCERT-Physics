<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NCERT Quiz - Final Fixed</title>
    
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* 2. CSS VARIABLES */
        :root {
            --bg-primary: #131314;       
            --bg-secondary: #1e1f20;     
            --text-main: #e3e3e3;        
            --text-dim: #9aa0a6;         
            --accent: #8ab4f8;           
            --success: #34a853;          
            --error: #ea4335;            
            --flag: #fbbc04;             
            --border: #3c4043;           
            --item-hover: #303134;       
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- HEADER --- */
        header {
            flex: 0 0 60px;
            padding: 0 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }
        
        .quiz-title { font-size: 1.1rem; color: var(--accent); margin: 0; font-weight: 500; }

        /* --- MAIN LAYOUT (Quiz Interface) --- */
        .layout { 
            display: flex; 
            flex: 1; 
            overflow: hidden; 
            position: relative; 
        }

        /* --- SIDEBAR (Palette) --- */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 15px;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .palette-header { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }

        .palette-scroll-area {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            margin-bottom: 10px;
            padding-right: 5px;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        /* BUTTON SHAPE: Leaf Style */
        .p-item {
            aspect-ratio: 1;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--border);
            /* This makes the Leaf Shape */
            border-radius: 12px 0px 12px 0px; 
            cursor: pointer; font-size: 0.9rem; color: var(--text-dim);
            transition: 0.2s;
        }
        .p-item:active { transform: scale(0.95); }
        .p-item.current { border-color: var(--accent); color: var(--accent); background: rgba(138, 180, 248, 0.1); border-width: 2px; font-weight: bold; }
        .p-item.attempted { background: var(--success); color: white; border-color: var(--success); }
        .p-item.flagged { background: var(--flag); color: black; border-color: var(--flag); }

        /* --- QUESTION AREA --- */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex; flex-direction: column;
        }

        .question-container { max-width: 800px; margin: 0 auto; width: 100%; padding-bottom: 20px; }

        .section-label { color: var(--accent); font-size: 0.8rem; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 15px; font-weight: bold; display: inline-block; background: rgba(138, 180, 248, 0.1); padding: 4px 8px; border-radius: 4px; }
        
        .question-text { font-size: 1.25rem; line-height: 1.5; margin-bottom: 25px; }

        .option {
            background: var(--bg-secondary);
            padding: 16px 20px;
            margin-bottom: 12px;
            border-radius: 12px;
            cursor: pointer;
            border: 1px solid var(--border);
            font-size: 1rem;
            transition: background 0.2s;
            display: flex; align-items: center;
        }
        .option.selected { border-color: var(--accent); background: rgba(138, 180, 248, 0.1); }
        .option.correct { background: rgba(52, 168, 83, 0.25) !important; border-color: var(--success) !important; }
        .option.wrong { background: rgba(234, 67, 53, 0.25) !important; border-color: var(--error) !important; }
        .option.disabled { pointer-events: none; }

        .feedback-card { display: none; margin-top: 20px; padding: 15px; background: #232425; border-left: 4px solid var(--accent); border-radius: 8px; }
        .controls { margin-top: 30px; display: flex; justify-content: space-between; align-items: center; }
        
        button { padding: 12px 24px; border-radius: 24px; border: none; font-weight: 600; cursor: pointer; font-size: 0.95rem; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--accent); color: var(--bg-primary); }
        .btn-secondary { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        .btn-flag { color: var(--flag); border: 1px solid var(--flag); background: transparent; }

        /* --- REPORT VIEW (Full Screen Overlay) --- */
        #report-view { 
            display: none; 
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: #fff; color: #000; 
            padding: 30px; 
            overflow-y: auto; 
            z-index: 20;
        }

        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 30px; text-align: center; }
        .stat-box { background: #f1f3f4; padding: 15px; border-radius: 8px; border: 1px solid #ddd; }
        .stat-val { font-size: 1.5rem; font-weight: bold; display: block; }
        .stat-lbl { font-size: 0.75rem; text-transform: uppercase; color: #5f6368; }
        
        .s-score { color: #202124; } 
        .s-correct { color: #188038; } 
        .s-wrong { color: #d93025; }
        .s-left { color: #f29900; }

        .rep-item { border-bottom: 1px solid #dadce0; padding: 15px 0; }
        .rep-q { font-weight: 700; margin-bottom: 8px; color: #202124; }
        .rep-row { display: flex; justify-content: space-between; font-size: 0.95rem; margin-bottom: 4px; }
        .rep-hint { background: #e8f0fe; color: #1967d2; padding: 10px; border-radius: 6px; font-size: 0.9rem; margin-top: 10px; border-left: 4px solid #1967d2; }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 768px) {
            .layout { flex-direction: column; }
            
            .main-content {
                order: 1; width: 100%; flex: 1; min-height: 0; padding: 20px; border-bottom: 1px solid var(--border);
            }
            
            .sidebar {
                order: 2; width: 100%; height: 35vh; min-height: 200px; border-right: none; border-top: 1px solid var(--border); flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom);
            }
            
            #btn-finish { flex-shrink: 0; margin-top: auto; }
            
            .palette-grid { grid-template-columns: repeat(6, 1fr); }
            .question-text { font-size: 1.1rem; }
            
            /* Report Mobile */
            .stats-grid { grid-template-columns: 1fr 1fr; }
            #report-view { padding: 15px; }
        }

        /* --- START SCREEN --- */
        #start-screen { position: fixed; inset: 0; background: var(--bg-primary); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .tooltip-wrap { position: relative; display: inline-block; }
        .tooltip-wrap::after { content: attr(data-tip); position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); width: 160px; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 8px; font-size: 0.75rem; opacity: 0; visibility: hidden; transition: 0.3s; pointer-events: none; z-index: 10; }
        .tooltip-wrap:hover::after { opacity: 1; visibility: visible; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="font-size: 2.5rem; color: var(--accent); margin-bottom: 10px;">Kinetic Theory</h1>
    <p style="color: var(--text-dim); margin-bottom: 40px;">Quiz 4: Final Review</p>
    <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
        <div class="tooltip-wrap" data-tip="Instant feedback.">
            <button class="btn-primary" onclick="startQuiz('practice')">Practice Mode</button>
        </div>
        <div class="tooltip-wrap" data-tip="Score at the end.">
            <button class="btn-secondary" onclick="startQuiz('exam')">Exam Mode</button>
        </div>
    </div>
</div>

<header id="main-header">
    <div class="header-left">
        <h1 class="quiz-title">Physics: Chapter 12</h1>
    </div>
</header>

<div class="layout" id="quiz-layout">
    <div class="sidebar" id="sidebar">
        <div class="palette-header" style="padding-bottom: 5px;">Question Palette</div>
        <div class="palette-scroll-area">
            <div class="palette-grid" id="p-grid"></div>
        </div>
        <button class="btn-secondary" id="btn-finish" style="width: 100%; border-radius: 8px; justify-content: center;" onclick="showReport()">Submit Quiz</button>
    </div>

    <div class="main-content">
        <div id="quiz-view" class="question-container">
            <div id="q-section" class="section-label"></div>
            <div id="q-text" class="question-text"></div>
            <div id="q-options"></div>
            
            <div id="feedback" class="feedback-card">
                <div style="font-size: 0.8rem; font-weight: 700; color: var(--accent); margin-bottom: 5px;">NCERT Reference: <span id="cite-ref"></span></div>
                <div id="hint-content" style="color: var(--text-main); font-size: 0.95rem;"></div>
            </div>

            <div class="controls">
                <button class="btn-flag" onclick="toggleFlag()">âš‘ Flag</button>
                <div style="display:flex; gap:10px;">
                    <button class="btn-secondary" onclick="nav(-1)">Prev</button>
                    <button class="btn-primary" onclick="nav(1)">Next</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="report-view">
    </div>

<script>
    /* 3. DATA ARRAY */
    const data = [
        { s: "12.7 Mean Free Path", q: "Why do gas molecules moving at hundreds of meters per second take a long time to diffuse across a room?", o: ["They are heavy", "They collide incessantly", "Gravity slows them", "They are magnetic"], a: 1, r: "Sec 12.7", h: "Collisions change their direction randomly, so the net path is small." },
        { s: "12.7 Mean Free Path", q: "The mean free path $l$ is inversely proportional to:", o: ["Temperature $T$", "Number density $n$", "Volume $V$", "Mass $m$"], a: 1, r: "Sec 12.7", h: "Formula: $l = 1 / (\\sqrt{2} n \\pi d^2)$. It depends on $n$ and diameter $d$." },
        { s: "12.7 Mean Free Path", q: "If the diameter of a gas molecule is doubled, the mean free path will:", o: ["Double", "Halve", "Decrease by 4 times", "Stay same"], a: 2, r: "Sec 12.7", h: "$l \\propto 1/d^2$. If $d$ becomes $2d$, $l$ becomes $1/4$." },
        { s: "12.7 Mean Free Path", q: "Although the mean free path is small, the 'Collision Frequency' is:", o: ["Very small", "Zero", "Very high", "Negative"], a: 2, r: "Sec 12.7", h: "Molecules travel fast but hit often (billions of times per second)." },
        { s: "12.7 Mean Free Path", q: "The mean free path depends on the size of the molecule. We treat molecules as:", o: ["Points", "Spheres of diameter $d$", "Cubes", "Waves"], a: 1, r: "Sec 12.7", h: "The derivation assumes molecules are spheres of diameter $d$." },
        { s: "Summary", q: "An ideal gas is one where intermolecular forces are:", o: ["Strong", "Repulsive", "Absent", "Magnetic"], a: 2, r: "Summary Pt 1", h: "Ideal gases are defined by the absence of intermolecular forces." },
        { s: "Summary", q: "Internal energy of an ideal gas depends only on:", o: ["Pressure", "Volume", "Temperature", "Density"], a: 2, r: "Summary Pt 2", h: "For ideal gases, internal energy is a function of T only." },
        { s: "Summary", q: "At absolute zero temperature, the kinetic energy of an ideal gas molecules is:", o: ["Maximum", "Zero", "Infinite", "Constant"], a: 1, r: "Summary Pt 3", h: "$E \\propto T$. If $T=0$, Kinetic Energy is zero." },
        { s: "Summary", q: "Which law states that equal volumes of gases at same P and T contain equal number of molecules?", o: ["Boyle's", "Charles'", "Avogadro's", "Dalton's"], a: 2, r: "Summary Pt 4", h: "This is Avogadro's Hypothesis." },
        { s: "Summary", q: "The pressure of a gas is the result of:", o: ["Static repulsion", "Momentum transfer to walls", "Gravitational weight", "Friction"], a: 1, r: "Summary Pt 5", h: "Collisions with the wall transfer momentum, creating force/area." },
        { s: "Summary", q: "Which energy mode is NOT excited at ordinary temperatures for rigid diatomic molecules?", o: ["Translation", "Rotation", "Vibration", "None"], a: 2, r: "Summary Pt 7", h: "Vibrational modes usually require high temperatures." },
        { s: "Points to Ponder", q: "Is the pressure of a gas equal to the force exerted by molecules on the wall?", o: ["Yes", "No, it is Force/Area", "No, it is Force x Area", "No, it is Momentum"], a: 1, r: "PTP 1", h: "Pressure is Force per unit Area, not just Force." },
        { s: "Points to Ponder", q: "Though collisions are random, why does a gas in equilibrium have uniform density?", o: ["Gravity", "Law of large numbers", "Electric forces", "It is a solid"], a: 1, r: "PTP 2", h: "With $10^{23}$ particles, fluctuations cancel out (Statistics)." },
        { s: "Points to Ponder", q: "In the ideal gas model, the volume of the molecules themselves is assumed to be:", o: ["Equal to container", "Negligible", "Half the container", "Variable"], a: 1, r: "PTP 3", h: "Molecules are points; their own volume is neglected." },
        { s: "Points to Ponder", q: "The temperature of a gas is a measure of:", o: ["Total Energy", "Average KE per molecule", "Maximum KE", "Potential Energy"], a: 1, r: "PTP 4", h: "Temperature relates to the average kinetic energy." },
        { s: "Points to Ponder", q: "Is it possible for a gas to have temperature if it consists of just one molecule?", o: ["Yes", "No", "Only if moving", "Only if stopped"], a: 1, r: "PTP 4", h: "Temperature is a statistical concept meaningful only for large collections." },
        { s: "Points to Ponder", q: "When a gas expands into a vacuum (free expansion), its temperature:", o: ["Increases", "Decreases", "Remains constant", "Becomes zero"], a: 2, r: "PTP 5", h: "No work is done and no heat is exchanged, so internal energy (and T) stays constant." },
        { s: "Points to Ponder", q: "The formula $P = 1/3 nm \\overline{v^2}$ is valid for:", o: ["Only Monoatomic", "Only Diatomic", "Any Ideal Gas", "Only Solids"], a: 2, r: "PTP 6", h: "It is valid regardless of the internal structure (rotation/vibration)." },
        { s: "Points to Ponder", q: "The mean free path increases if the density of the gas:", o: ["Increases", "Decreases", "Stays same", "Becomes infinite"], a: 1, r: "Sec 12.7", h: "Lower density means fewer obstacles, so path length increases." },
        { s: "Points to Ponder", q: "Which speed is generally larger in a gas distribution?", o: ["Most Probable", "Average", "RMS", "Zero"], a: 2, r: "PTP 6", h: "$v_{rms} > v_{avg} > v_{mp}$." }
    ];

    /* 4. APP LOGIC */
    let current = 0;
    let mode = 'practice';
    let answers = new Array(data.length).fill(null);
    let flagged = new Array(data.length).fill(false);

    function startQuiz(m) {
        mode = m;
        document.getElementById('start-screen').style.display = 'none';
        renderPalette();
        renderQ();
    }

    function renderPalette() {
        const grid = document.getElementById('p-grid');
        grid.innerHTML = '';
        data.forEach((_, i) => {
            const btn = document.createElement('div');
            btn.className = `p-item ${i===current ? 'current' : ''} ${answers[i]!==null ? 'attempted' : ''} ${flagged[i] ? 'flagged' : ''}`;
            btn.innerText = i + 1;
            btn.onclick = () => { 
                current = i; 
                renderQ(); 
                renderPalette();
            };
            grid.appendChild(btn);
        });
    }

    function renderQ() {
        const item = data[current];
        document.getElementById('q-section').innerText = item.s;
        document.getElementById('q-text').innerHTML = `Q${current + 1}: ${item.q}`;
        const optsDiv = document.getElementById('q-options');
        optsDiv.innerHTML = '';

        item.o.forEach((optText, idx) => {
            const div = document.createElement('div');
            let cls = 'option';
            if (answers[current] !== null) {
                cls += ' disabled';
                if (mode === 'practice') {
                    if (idx === item.a) cls += ' correct';
                    else if (idx === answers[current]) cls += ' wrong';
                } else {
                    if (idx === answers[current]) cls += ' selected';
                }
            }
            div.className = cls;
            div.innerHTML = optText;
            div.onclick = () => selectAnswer(idx);
            optsDiv.appendChild(div);
        });

        const fb = document.getElementById('feedback');
        if (mode === 'practice' && answers[current] !== null) {
            fb.style.display = 'block';
            document.getElementById('cite-ref').innerText = item.r;
            document.getElementById('hint-content').innerText = item.h;
        } else {
            fb.style.display = 'none';
        }
        if (window.MathJax) MathJax.typesetPromise();
    }

    function selectAnswer(idx) {
        if (answers[current] !== null) return;
        answers[current] = idx;
        renderQ();
        renderPalette();
    }

    function nav(dir) {
        const next = current + dir;
        if (next >= 0 && next < data.length) {
            current = next;
            renderQ();
            renderPalette();
        }
    }

    function toggleFlag() {
        flagged[current] = !flagged[current];
        renderPalette();
    }

    function showReport() {
        if (!confirm("Submit Quiz?")) return;
        
        // Hide Main Layout and Header
        document.getElementById('quiz-layout').style.display = 'none';
        document.getElementById('main-header').style.display = 'none';
        
        // Show Report View
        const reportDiv = document.getElementById('report-view');
        reportDiv.style.display = 'block';
        document.body.style.overflow = 'auto'; // Enable scrolling

        let score = 0, wrong = 0, left = 0;
        let detailsHtml = '';

        data.forEach((item, i) => {
            const u = answers[i];
            if(u === null) left++;
            else if(u === item.a) score++;
            else wrong++;

            const uText = (u !== null) ? item.o[u] : 'Unanswered';
            
            detailsHtml += `
            <div class="rep-item">
                <div class="rep-q">Q${i+1}: ${item.q}</div>
                <div class="rep-row"><span>Your Answer:</span> <strong style="color:${u === item.a ? '#188038' : '#d93025'}">${uText}</strong></div>
                ${u !== item.a ? `<div class="rep-row"><span>Correct:</span> <strong>${item.o[item.a]}</strong></div>` : ''}
                <div class="rep-hint">Hint: ${item.h} (${item.r})</div>
            </div>`;
        });

        const pct = Math.round((score / data.length) * 100);
        
        reportDiv.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0;">Results</h2>
                <button class="btn-primary" onclick="downloadPDF()">Download PDF</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-box"><div class="stat-val s-score">${pct}%</div><div class="stat-lbl">Score</div></div>
                <div class="stat-box"><div class="stat-val s-correct">${score}</div><div class="stat-lbl">Correct</div></div>
                <div class="stat-box"><div class="stat-val s-wrong">${wrong}</div><div class="stat-lbl">Wrong</div></div>
                <div class="stat-box"><div class="stat-val s-left">${left}</div><div class="stat-lbl">Left</div></div>
            </div>
            <div>${detailsHtml}</div>
        `;
        
        if(window.MathJax) MathJax.typesetPromise();
    }

    function downloadPDF() {
        const element = document.getElementById('report-view');
        const opt = {
            margin: 10,
            filename: 'Quiz_Report.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>
</body>
</html>
